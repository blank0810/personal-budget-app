# v1.5 Enhancement Plan

This document provides a detailed analysis and implementation plan for the Budget Analytics feature.

---

## Table of Contents

1. [Budget Analytics Overview](#1-budget-analytics-overview)
2. [Budget Health Summary (Budget Page)](#2-budget-health-summary-budget-page)
3. [Budget Analytics Tab (Reports Page)](#3-budget-analytics-tab-reports-page)
4. [Service Layer Implementation](#4-service-layer-implementation)
5. [Implementation Order](#5-implementation-order)

---

## 1. Budget Analytics Overview

### Goal

Add budget analytics with **problem detection** and **progress tracking** - split between Budget page (quick alerts) and Reports page (detailed analysis).

### Accountant Perspective

As a financial manager, the current "Budget vs Actual" graph tells *what happened* but doesn't help understand *patterns* or make *decisions*. The analytics feature addresses:

1. **Problem Detection**: Which budgets consistently go over? Which are set too high?
2. **Progress Tracking**: Is budget discipline improving over time?

### Feature Distribution

| Location | Purpose | Content |
|----------|---------|---------|
| **Budget Page** | Alert System | Quick health summary, problem flags |
| **Reports Page** | Analysis & Recommendations | Detailed trends, category analysis, recommendations |

---

## 2. Budget Health Summary (Budget Page)

### Location
Top of Budget page, above the budget list.

### UI Design
```
┌─────────────────────────────────────────────────────┐
│  Budget Health                        December 2025 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│  3 of 5 budgets on track                            │
│  Groceries needs attention (over 3 months)          │
│  Dining Out at 95% - watch this one                 │
└─────────────────────────────────────────────────────┘
```

### Component Props
```typescript
interface BudgetHealthSummaryProps {
  health: {
    totalBudgets: number;
    onTrack: number;      // < 80% spent
    warning: number;      // 80-100% spent
    over: number;         // > 100% spent
    problemCategories: Array<{
      name: string;
      status: 'warning' | 'over';
      detail: string;
    }>;
  };
  month: Date;
}
```

### Files
- Modify: `app/(authenticated)/budgets/page.tsx`
- Create: `components/modules/budget/BudgetHealthSummary.tsx`

---

## 3. Budget Analytics Tab (Reports Page)

### Location
New tab in Reports page alongside existing tabs.

### Section 3a: Monthly Summary Card
```
┌─────────────────────────────────────────────────────┐
│  December 2025 Summary                              │
│  Budgeted: $2,500  |  Spent: $2,150  |  Saved: $350 │
│  [=================-----] 86% utilized              │
└─────────────────────────────────────────────────────┘
```

### Section 3b: Category Performance Table

| Category | Avg Budget | Avg Spent | Variance | Trend | Recommendation |
|----------|------------|-----------|----------|-------|----------------|
| Groceries | $400 | $480 | +20% | Over 4/6 months | Increase to $500 |
| Entertainment | $200 | $80 | -60% | Under 5/6 months | Reduce to $100 |
| Utilities | $150 | $145 | -3% | Stable | On track |

### Section 3c: Progress Chart (6-month trend)
- Line/bar chart showing monthly adherence percentage
- Budget Health Score with trend indicator

### Files
- Modify: `app/(authenticated)/reports/page.tsx`
- Create: `components/modules/reports/BudgetAnalytics.tsx`

---

## 4. Service Layer Implementation

### File
`server/modules/budget/budget.service.ts`

### Method 1: getBudgetHealthSummary
```typescript
async getBudgetHealthSummary(userId: string, month?: Date) {
  // Returns current month budget health
  // - Count budgets by status (on-track, warning, over)
  // - Flag problem categories (over 3+ months)
  // - Calculate totals (budgeted vs spent)
}
```

### Method 2: getBudgetTrends
```typescript
async getBudgetTrends(userId: string, months: number = 6) {
  // Returns historical performance
  // - Monthly breakdown of budgeted vs spent
  // - Adherence percentage per month
  // - Categories on-track vs over count
}
```

### Method 3: getBudgetRecommendations
```typescript
async getBudgetRecommendations(userId: string, months: number = 6) {
  // Returns category-level analysis
  // - Average budget vs average spent per category
  // - Variance percentage
  // - Recommendation: increase / decrease / stable
  // - Suggested new amount (based on historical spending)
}
```

### Problem Detection Thresholds
```typescript
// Category is flagged as:
// - "Needs Increase": Over budget 3+ of last 6 months
// - "Consider Reduce": Under 60% for 3+ months
// - "Stable": Within 60-100% most months
```

### Budget Health Score Calculation
```typescript
// Score = weighted average of:
// - Categories on track (50%)
// - Overall adherence (30%)
// - Improvement trend (20%)
```

---

## 5. Implementation Order

### Phase 1: Service Layer
1. Add `getBudgetHealthSummary` method
2. Add `getBudgetTrends` method
3. Add `getBudgetRecommendations` method

### Phase 2: Budget Page Enhancement
4. Create `BudgetHealthSummary` component
5. Integrate into budgets page

### Phase 3: Reports Page Enhancement
6. Create `BudgetAnalytics` component
7. Add new tab to reports page

### Phase 4: Testing & Refinement
8. Test with various budget scenarios
9. Handle edge cases (no budgets, new user)
10. Refine recommendation logic

---

## Files Summary

| File | Action | Purpose |
|------|--------|---------|
| `server/modules/budget/budget.service.ts` | Modify | Add analytics methods |
| `app/(authenticated)/budgets/page.tsx` | Modify | Add health summary card |
| `components/modules/budget/BudgetHealthSummary.tsx` | Create | Quick glance component |
| `app/(authenticated)/reports/page.tsx` | Modify | Add Budget Analytics tab |
| `components/modules/reports/BudgetAnalytics.tsx` | Create | Detailed analytics view |

---

## Testing Checklist

- [x] Budget page shows health summary card
- [x] Problem categories flagged correctly (over 3+ months)
- [x] Reports page has new "Budget Analytics" tab
- [x] Monthly summary shows budgeted vs spent vs saved
- [x] Category table shows recommendations
- [x] 6-month trend displays correctly
- [x] Empty state handled (no budgets, new user)

---

## Implementation Status

### Completed Files

| File | Status | Description |
|------|--------|-------------|
| `server/modules/budget/budget.types.ts` | ✅ Done | Added analytics types (BudgetHealthSummary, MonthlyTrend, CategoryRecommendation) |
| `server/modules/budget/budget.service.ts` | ✅ Done | Added 3 analytics methods |
| `components/modules/budget/BudgetHealthSummary.tsx` | ✅ Done | Health summary card with status indicators |
| `app/(authenticated)/budgets/page.tsx` | ✅ Done | Integrated health summary |
| `components/modules/reports/BudgetAnalytics.tsx` | ✅ Done | Full analytics tab with chart and table |
| `app/(authenticated)/reports/page.tsx` | ✅ Done | Added Budget Analytics tab |

---

_Document created: December 30, 2024_
_Implementation completed: December 31, 2024_
_Version: 1.5_
